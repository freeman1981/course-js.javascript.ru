{"version":3,"sources":["webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js","webpack:///./src/utils/fetch-json.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/notification/index.js"],"names":["ProductForm","data","fetchUrl","this","getFetchUrl","productsUrl","requestParams","method","productId","headers","body","JSON","stringify","fetchJson","customEventName","productEditMode","element","dispatchEvent","CustomEvent","bubbles","detail","event","showNotificationMessage","message","duration","type","NotificationMessage","show","constructor","url","preventDefault","productForm","imageListContainer","subElements","formData","FormData","payloadFields","formatToNumber","name","value","includes","parseInt","id","images","imagesHTMLCollection","querySelectorAll","image","alt","src","push","source","sendFormData","async","file","inputElement","files","append","lastElementChild","uploadImageButton","response","classList","add","Authorization","process","appendUploadedImageToSortableList","err","remove","fileName","link","firstElementChild","sortableImageList","items","map","getImageItem","sortableList","SortableList","wrapper","document","createElement","innerHTML","onchange","uploadImage","click","Boolean","categoriesUrl","categories","productData","getAllData","getEditProductFormTemplate","getCreateProductFormTemplate","getSubElements","createImagesList","initEventListeners","addEventListener","onUploadImageButtonClick","onFormSubmit","requests","getSingleData","_sort","_refs","productRequest","Promise","all","searchQueryParams","URL","param","val","Object","entries","searchParams","set","reduce","accum","subElement","dataset","getTitleTemplate","getDescriptionTemplate","getSortableImageListContainerTemplate","getProductCategoriesTemplate","getProductPriceDiscountTemplate","getProductQuantityTemplate","getProductStatusTemplate","title","escapeHtml","description","productSubcategory","subcategory","categotyTitle","subcategories","subcategoryId","subcategoryTitle","join","price","discount","quantity","status","destroy","Page","match","render","components","template","initComponents","renderComponents","keys","forEach","component","root","$element","values","params","fetch","toString","FetchError","ok","errorText","statusText","json","error","Error","super","window","reason","alert","string","replace","clientX","clientY","moveDraggingAt","children","top","firstElementTop","getBoundingClientRect","bottom","movePlaceholderAt","length","i","li","draggingElem","offsetHeight","height","scrollIfCloseToWindowEdge","dragStop","className","addItems","onPointerDown","item","which","itemElem","target","closest","dragStart","elementInitialIndex","indexOf","pointerInitialShift","x","y","placeholderElem","style","width","offsetWidth","after","onDocumentPointerMove","onDocumentPointerUp","left","scrollBy","documentElement","clientHeight","index","currentElement","insertBefore","placeholderIndex","replaceWith","removeEventListener","from","to","activeComponent","parent","setTimeout"],"mappings":"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","file":"products-edit-index-js-4.js","sourcesContent":["import SortableList from '../../components/sortable-list/index.js';\nimport NotificationMessage from '../../components/notification/index.js';\nimport escapeHtml from '../../utils/escape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\n\nconst IMGUR_CLIENT_ID = process.env.IMGUR_CLIENT_ID;\nconst BACKEND_URL = process.env.BACKEND_URL;\n\nexport default class ProductForm {\n  element; //html element\n  inputElement; //html element\n  productData = null;\n  categories = null;\n\n  onFormSubmit = (event) => {\n    event.preventDefault();\n\n    const {productForm, imageListContainer} = this.subElements;\n    const formData = new FormData(productForm);\n    const data = {};\n    const payloadFields = [\n      \"title\",\n      \"description\",\n      \"subcategory\",\n      \"price\",\n      \"quantity\",\n      \"discount\",\n      \"status\"\n    ];\n    const formatToNumber = [\"price\", \"quantity\", \"discount\", \"status\"];\n\n    for (let [name, value] of formData) {\n      if (payloadFields.includes(name)) {\n        value = (formatToNumber.includes(name))\n          ? parseInt(value, 10)\n          : value;\n        data[name] = value;\n      }\n    }\n\n    if (this.productEditMode) {\n      data.id = this.productId;\n    }\n\n    data.images = [];\n\n    const imagesHTMLCollection = imageListContainer.querySelectorAll('.sortable-table__cell-img');\n\n    for (const image of imagesHTMLCollection) {\n      const {alt, src} = image;\n      data.images.push({\n        url: src,\n        source: alt\n      });\n    }\n\n    this.sendFormData(data);\n  }\n\n  async sendFormData(data) {\n    const fetchUrl = this.getFetchUrl(this.productsUrl);\n\n    const requestParams = {\n      method: this.productId ? 'PATCH' : 'PUT',\n      headers:             {\n        'Content-Type': 'application/json;charset=utf-8'\n      },\n      body: JSON.stringify(data)\n    }\n\n    await fetchJson(fetchUrl, requestParams);\n\n    const customEventName = (this.productEditMode) ? \"product-updated\" : \"product-saved\";\n    this.element.dispatchEvent(new CustomEvent(customEventName, {\n      bubbles: true,\n      detail: event\n    }));\n\n  }\n\n  uploadImage = async () => {\n    const [file] = this.inputElement.files;\n\n    if (!file) return;\n\n    const formData = new FormData();\n    formData.append('image', file);\n\n    const {lastElementChild: uploadImageButton} = this.subElements[\"sortable-list-container\"];\n    uploadImageButton.classList.add(\"is-loading\");\n\n    let response;\n\n    try {\n\n      response = await fetchJson('https://api.imgur.com/3/image', {\n        method: 'POST',\n        headers:             {\n          Authorization: `Client-ID ${IMGUR_CLIENT_ID}`\n        },\n        body: formData,\n      });\n      this.showNotificationMessage(`Image upload succeeded!`, {type: \"success\"});\n      this.appendUploadedImageToSortableList(file, response);\n\n    } catch (err) {\n\n      this.showNotificationMessage(`Upload to the server failed! Please try again later! ${err}`, {type: \"error\", duration: 3000});\n\n    } finally {\n\n      uploadImageButton.classList.remove(\"is-loading\");\n\n    }\n  }\n\n  showNotificationMessage(message, {duration = 2000, type} = {}) {\n    const notificationMessage = new NotificationMessage(message, {\n      duration: duration,\n      type: type\n    });\n    notificationMessage.show();\n  }\n\n  appendUploadedImageToSortableList = (file, response) => {\n    const {name: fileName} = file;\n    const {link} = response.data;\n\n    const {firstElementChild: sortableImageList} = this.subElements.imageListContainer;\n\n    const images = [\n      {\n        url: link,\n        source: fileName\n      }\n    ];\n\n    const items = images.map(({url, source}) => this.getImageItem(url, source));\n\n    const sortableList = new SortableList({\n      items\n    });\n\n    sortableImageList.append(sortableList.element);\n  }\n\n  onUploadImageButtonClick = (event) => {\n    event.preventDefault();\n\n    const wrapper = document.createElement('div');\n    wrapper.innerHTML = '<input type=\"file\" accept=\"image/*\" hidden=\"\">'\n    this.inputElement = wrapper.firstElementChild;\n    document.body.append(this.inputElement);\n\n    this.inputElement.onchange = this.uploadImage;\n\n    this.inputElement.click();\n  }\n\n  // TODO: check if it is a good place for url param or it should be put outside of class\n  constructor(productId, url = \"api/rest/products\") {\n    this.productId = productId;\n    this.productEditMode = Boolean(this.productId);\n    this.productsUrl = url;\n    this.categoriesUrl = \"api/rest/categories\";\n  }\n\n  async render() {\n\n    const wrapper = document.createElement('div');\n\n    [this.categories, this.productData] = await this.getAllData(this.productEditMode);\n\n    if (this.productEditMode) {\n      wrapper.innerHTML = this.getEditProductFormTemplate(this.productData, this.categories);\n    } else {\n      wrapper.innerHTML = this.getCreateProductFormTemplate(this.categories);\n    }\n\n    const element = wrapper.firstElementChild;\n\n    this.element = element;\n\n    this.subElements = this.getSubElements();\n\n    this.createImagesList();\n\n    this.initEventListeners();\n\n    return this.element;\n  }\n\n  initEventListeners() {\n    const uploadImageButton = this.subElements[\"sortable-list-container\"].lastElementChild;\n\n    uploadImageButton.addEventListener(\"click\", this.onUploadImageButtonClick);\n    this.element.addEventListener(\"submit\", this.onFormSubmit);\n  }\n\n  async getAllData(productEditMode) {\n    const categoriesRequest = this.getSingleData(this.categoriesUrl, {_sort: \"weight\", _refs: \"subcategory\"});\n\n    const requests = [\n      categoriesRequest\n    ]\n\n    if (productEditMode) {\n      const productRequest = this.getSingleData(this.productsUrl, {id: this.productId});\n      requests.push(productRequest);\n    }\n\n    return await Promise.all(requests);\n  }\n\n  async getSingleData(url, searchQueryParams) {\n    const fetchUrl = this.getFetchUrl(url, searchQueryParams);\n    const response = await fetchJson(fetchUrl);\n    return response;\n  }\n\n  getFetchUrl(url, searchQueryParams) {\n    const fetchUrl = new URL(url, BACKEND_URL);\n\n    if (searchQueryParams) {\n      for (let [param, val] of Object.entries(searchQueryParams)) {\n        fetchUrl.searchParams.set(param, val);\n      }\n    }\n\n    return fetchUrl;\n  }\n\n  getSubElements(element = this.element) {\n    const elements = element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((accum, subElement) => {\n      accum[subElement.dataset.element] = subElement;\n\n      return accum;\n    }, {});\n  }\n\n  getEditProductFormTemplate([productData], categories) {\n    return `\n      <div class=\"product-form\">\n        <form data-element=\"productForm\" class=\"form-grid\">\n          ${this.getTitleTemplate(productData)}\n          ${this.getDescriptionTemplate(productData)}\n          ${this.getSortableImageListContainerTemplate()}\n          ${this.getProductCategoriesTemplate(categories, productData)}\n          ${this.getProductPriceDiscountTemplate(productData)}\n          ${this.getProductQuantityTemplate(productData)}\n          ${this.getProductStatusTemplate(productData)}\n          <div class=\"form-buttons\">\n            <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\n              Сохранить товар\n            </button>\n          </div>\n        </form>\n      </div>\n    `;\n  }\n\n  getTitleTemplate({title}) {\n    return `\n      <div class=\"form-group form-group__half_left\">\n        <fieldset>\n          <label class=\"form-label\">Название товара</label>\n          <input required=\"\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\" value=\"${escapeHtml(title)}\">\n        </fieldset>\n      </div>\n    `;\n  }\n\n  getDescriptionTemplate({description}) {\n    return `\n      <div class=\"form-group form-group__wide\">\n        <label class=\"form-label\">Описание</label>\n        <textarea required=\"\" class=\"form-control\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\">${escapeHtml(description)}\"</textarea>\n      </div>\n    `;\n  }\n\n  getSortableImageListContainerTemplate() {\n    return `\n      <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\n        <label class=\"form-label\">Фото</label>\n        <div data-element=\"imageListContainer\">\n        </div>\n        <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline\"><span>Загрузить</span></button>\n      </div>\n    `;\n  }\n\n  getProductCategoriesTemplate(categories, productData) {\n    let productSubcategory;\n    if (productData) {\n      ({subcategory: productSubcategory} = productData);\n    }\n    return `\n      <div class=\"form-group form-group__half_left\">\n        <label class=\"form-label\">Категория</label>\n        <select class=\"form-control\" name=\"subcategory\">\n        ${categories\n          .map( ({title: categotyTitle, subcategories}) => {\n            return subcategories\n              .map( ({id: subcategoryId, title: subcategoryTitle}) => {\n                return `\n                  <option ${(productSubcategory && productSubcategory === subcategoryId) ? \"selected\" : \"\"} value=\"${subcategoryId}\">${categotyTitle} &gt; ${subcategoryTitle}</option>\n                `;\n              });\n          }).join(\"\")}\n        </select>\n      </div>\n    `;\n  }\n\n  getProductPriceDiscountTemplate({price, discount}) {\n    return `\n      <div class=\"form-group form-group__half_left form-group__two-col\">\n        <fieldset>\n          <label class=\"form-label\">Цена ($)</label>\n          <input required=\"\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"100\" value=\"${price}\">\n        </fieldset>\n        <fieldset>\n          <label class=\"form-label\">Скидка ($)</label>\n          <input required=\"\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"0\" value=\"${discount}\">\n        </fieldset>\n      </div>\n    `;\n  }\n\n  getProductQuantityTemplate({quantity}) {\n    return `\n      <div class=\"form-group form-group__part-half\">\n        <label class=\"form-label\">Количество</label>\n        <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"1\" value=\"${quantity}\">\n      </div>\n    `;\n  }\n\n  getProductStatusTemplate({status}) {\n    return `\n      <div class=\"form-group form-group__part-half\">\n        <label class=\"form-label\">Статус</label>\n        <select class=\"form-control\" name=\"status\">\n          <option ${(status === 1) ? \"selected\" : \"\"} value=\"1\">Активен</option>\n          <option ${(status === 0) ? \"selected\" : \"\"} value=\"0\">Неактивен</option>\n        </select>\n      </div>\n    `;\n  }\n\n  createImagesList() {\n    if (!this.productData) {\n      return;\n    };\n    const {imageListContainer} = this.subElements;\n    const [productData] = this.productData;\n    const {images} = productData;\n\n    const items = images.map(({url, source}) => this.getImageItem(url, source));\n\n    const sortableList = new SortableList({\n      items\n    });\n\n    imageListContainer.append(sortableList.element);\n  }\n\n  getImageItem(url, name) {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = `\n      <li class=\"products-edit__imagelist-item sortable-list__item\">\n        <span>\n          <img src=\"/icon-grab.svg\" data-grab-handle alt=\"grab\">\n          <img class=\"sortable-table__cell-img\" alt=\"${escapeHtml(name)}\" src=\"${escapeHtml(url)}\">\n          <span>${escapeHtml(name)}</span>\n        </span>\n        <button type=\"button\">\n          <img src=\"/icon-trash.svg\" alt=\"delete\" data-delete-handle>\n        </button>\n      </li>`;\n\n    return wrapper.firstElementChild;\n  }\n\n  getCreateProductFormTemplate(categories) {\n    return `\n      <div class=\"product-form\">\n        <form data-element=\"productForm\" class=\"form-grid\">\n        <div class=\"form-group form-group__half_left\">\n          <fieldset>\n            <label class=\"form-label\">Название товара</label>\n            <input required=\"\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\">\n          </fieldset>\n        </div>\n        <div class=\"form-group form-group__wide\">\n          <label class=\"form-label\">Описание</label>\n          <textarea required=\"\" class=\"form-control\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\"></textarea>\n        </div>\n        <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\n          <label class=\"form-label\">Фото</label>\n          <div data-element=\"imageListContainer\"><ul class=\"sortable-list\"></ul></div>\n          <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline fit-content\"><span>Загрузить</span></button>\n        </div>\n        ${this.getProductCategoriesTemplate(categories)}\n        <div class=\"form-group form-group__half_left form-group__two-col\">\n          <fieldset>\n            <label class=\"form-label\">Цена ($)</label>\n            <input required=\"\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"100\">\n          </fieldset>\n          <fieldset>\n            <label class=\"form-label\">Скидка ($)</label>\n            <input required=\"\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"0\">\n          </fieldset>\n        </div>\n        <div class=\"form-group form-group__part-half\">\n          <label class=\"form-label\">Количество</label>\n          <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"1\">\n        </div>\n        <div class=\"form-group form-group__part-half\">\n          <label class=\"form-label\">Статус</label>\n          <select class=\"form-control\" name=\"status\">\n            <option value=\"1\">Активен</option>\n            <option value=\"0\">Неактивен</option>\n          </select>\n        </div>\n        <div class=\"form-buttons\">\n          <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\n            Добавить товар\n          </button>\n        </div>\n      </form>\n      </div>\n    `;\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n    this.subElements = {};\n  }\n\n}\n","import ProductForm from '../../../components/product-form/index.js';\n\nexport default class Page {\n  element;\n  subElements = {};\n  components = {};\n\n  constructor(match) {\n    this.match = match;\n  }\n\n  async initComponents () {\n    const [, productId] = this.match;\n    const productForm = new ProductForm(productId);\n    await productForm.render();\n    this.components.productForm = productForm;\n  }\n\n  get template () {\n    return `\n    <div class=\"products-edit\">\n      <div class=\"content__top-panel\">\n        <h1 class=\"page-title\">\n          <a href=\"/products\" class=\"link\">Товары</a> / Добавить\n        </h1>\n      </div>\n      <div class=\"content-box\">\n        <div data-element=\"productForm\">\n          <!-- product-form component -->\n        </div>\n      </div>\n    </div>`;\n  }\n\n  async render () {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n\n    this.element = element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    await this.initComponents();\n\n    this.renderComponents();\n\n    return this.element;\n  }\n\n  renderComponents () {\n    Object.keys(this.components).forEach(component => {\n      const root = this.subElements[component];\n      const { element } = this.components[component];\n      root.append(element);\n    });\n  }\n\n  getSubElements ($element) {\n    const elements = $element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((accum, subElement) => {\n      accum[subElement.dataset.element] = subElement;\n\n      return accum;\n    }, {});\n  }\n\n  destroy () {\n    for (const component of Object.values(this.components)) {\n      component.destroy();\n    }\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\n// status >= 400 is an error\n// network error / json error are errors\n\nexport default async function(url, params) {\n  let response;\n\n  try {\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\n    response = await fetch(url.toString(), params);\n  } catch(err) {\n    throw new FetchError(response, \"Network error has occurred.\");\n  }\n\n  let body;\n\n  if (!response.ok) {\n    let errorText = response.statusText; // Not Found (for 404)\n\n    try {\n      body = await response.json();\n\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\n    } catch (error) { /* ignore failed body */ }\n\n    let message = `Error ${response.status}: ${errorText}`;\n\n    throw new FetchError(response, body, message);\n  }\n\n  try {\n    return await response.json();\n  } catch(err) {\n    throw new FetchError(response, null, err.message);\n  }\n}\n\nexport class FetchError extends Error {\n  name = \"FetchError\";\n\n  constructor(response, body, message) {\n    super(message);\n    this.response = response;\n    this.body = body;\n  }\n}\n\n// handle uncaught failed fetch through\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason instanceof FetchError) {\n    alert(event.reason.message);\n  }\n});\n\n","export default string => string\n  .replace(/&/g, '&amp;')\n  .replace(/\"/g, '&quot;')\n  .replace(/'/g, '&#39;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;');\n","export default class SortableList {\n  element;\n\n  onDocumentPointerMove = ({clientX, clientY}) => {\n    this.moveDraggingAt(clientX, clientY);\n\n    const {firstElementChild, children} = this.element;\n    const {top: firstElementTop} = firstElementChild.getBoundingClientRect();\n    const {bottom} = this.element.getBoundingClientRect();\n\n    if (clientY < firstElementTop) {\n      this.movePlaceholderAt(0);\n    } else if (clientY > bottom) {\n      this.movePlaceholderAt(children.length);\n    } else {\n      for (let i = 0; i < children.length; i++) {\n        const li = children[i];\n\n        if (li !== this.draggingElem) {\n          const {top, bottom} = li.getBoundingClientRect();\n          const {offsetHeight: height} = li;\n\n          if (clientY > top && clientY < bottom) {\n            if (clientY < top + height / 2) {\n              this.movePlaceholderAt(i);\n              break;\n            } else {\n              this.movePlaceholderAt(i + 1);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    this.scrollIfCloseToWindowEdge(clientY);\n  };\n\n  onDocumentPointerUp = () => {\n    this.dragStop();\n  };\n\n  constructor({items = []} = {}) {\n    this.items = items;\n\n    this.render();\n  }\n\n  render() {\n    this.element = document.createElement('ul');\n    this.element.className = 'sortable-list';\n\n    this.addItems();\n    this.initEventListeners();\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('pointerdown', event => this.onPointerDown(event));\n  }\n\n  addItems() {\n    for (let item of this.items) {\n      item.classList.add('sortable-list__item');\n    }\n\n    this.element.append(...this.items);\n  }\n\n  onPointerDown(event) {\n    if (event.which !== 1) { // must be left-button\n      return false;\n    }\n\n    const itemElem = event.target.closest('.sortable-list__item');\n\n    if (itemElem) {\n      if (event.target.closest('[data-grab-handle]')) {\n        event.preventDefault();\n\n        this.dragStart(itemElem, event);\n      }\n\n      if (event.target.closest('[data-delete-handle]')) {\n        event.preventDefault();\n\n        itemElem.remove();\n      }\n    }\n  }\n\n  dragStart(itemElem, {clientX, clientY}) {\n    this.elementInitialIndex = [...this.element.children].indexOf(itemElem);\n\n    this.pointerInitialShift = {\n      x: clientX - itemElem.getBoundingClientRect().x,\n      y: clientY - itemElem.getBoundingClientRect().y\n    };\n\n    this.draggingElem = itemElem;\n\n    this.placeholderElem = document.createElement('li');\n    this.placeholderElem.className = 'sortable-list__placeholder';\n\n    itemElem.style.width = `${itemElem.offsetWidth}px`;\n    itemElem.style.height = `${itemElem.offsetHeight}px`;\n\n    this.placeholderElem.style.width = itemElem.style.width;\n    this.placeholderElem.style.height = itemElem.style.height;\n\n    itemElem.classList.add('sortable-list__item_dragging');\n\n    itemElem.after(this.placeholderElem);\n\n    this.element.append(itemElem);\n\n    this.moveDraggingAt(clientX, clientY);\n\n    document.addEventListener('pointermove', this.onDocumentPointerMove);\n    document.addEventListener('pointerup', this.onDocumentPointerUp);\n  }\n\n  moveDraggingAt(clientX, clientY) {\n    this.draggingElem.style.left = clientX - this.pointerInitialShift.x + 'px';\n    this.draggingElem.style.top = clientY - this.pointerInitialShift.y + 'px';\n  }\n\n  scrollIfCloseToWindowEdge(clientY) {\n    const scrollingValue = 10;\n    const threshold = 20;\n\n    if (clientY < threshold) {\n      window.scrollBy(0, -scrollingValue);\n    } else if (clientY > document.documentElement.clientHeight - threshold) {\n      window.scrollBy(0, scrollingValue);\n    }\n  }\n\n  movePlaceholderAt(index) {\n    const currentElement = this.element.children[index];\n\n    if (currentElement !== this.placeholderElem) {\n      this.element.insertBefore(this.placeholderElem, currentElement);\n    }\n  }\n\n  dragStop() {\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElem);\n\n    this.placeholderElem.replaceWith(this.draggingElem);\n    this.draggingElem.classList.remove('sortable-list__item_dragging');\n\n    this.draggingElem.style.left = '';\n    this.draggingElem.style.top = '';\n    this.draggingElem.style.width = '';\n    this.draggingElem.style.height = '';\n\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\n\n    this.draggingElem = null;\n\n    if (placeholderIndex !== this.elementInitialIndex) {\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\n        bubbles: true,\n        detail: {\n          from: this.elementInitialIndex,\n          to: placeholderIndex\n        }\n      }));\n    }\n  }\n\n  remove() {\n    this.element.remove();\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\n  }\n\n  destroy() {\n    this.remove();\n  }\n}","export default class NotificationMessage {\n  static activeComponent;\n\n  element; // HTMLElement;\n\n  constructor(\n    message, \n    {\n      duration,\n      type\n    } = {}) {\n    this.message = message;\n    this.duration = duration;\n    this.type = type;\n    \n    this.render();\n  }\n\n  get template() {\n    return `\n      <div class=\"notification notification_${this.type} show\" style=\"--value:${this.duration / 1000}s\">\n        <div class=\"notification__content\">\n          ${this.message}\n        </div>\n      </div>\n    `;\n  }\n\n  render() {\n\n    if (NotificationMessage.activeComponent) {\n      NotificationMessage.activeComponent.remove();\n    }\n\n    const element = document.createElement('div');\n    element.innerHTML = this.template;\n    this.element = element.firstElementChild;\n    NotificationMessage.activeComponent = this.element;\n  }\n\n  show(parent = document.body) {\n    parent.append(this.element);\n\n    setTimeout(() => {\n      this.remove();\n    }, this.duration);\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n  }\n}"],"sourceRoot":""}